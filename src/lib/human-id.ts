// Listas de palavras para gênero masculino
export const adjetivosM = [
  "rápido",
  "forte",
  "brilhante",
  "bom",
  "feliz",
  "amável",
  "sábio",
  "valente",
  "vivo",
  "novo",
  "audaz",
  "esperto",
  "ágil",
  "decidido",
  "destemido",
  "vigoroso",
  "agradável",
  "duro",
  "mau",
  "alegre",
  "enorme",
  "antigo",
  "querido",
  "famoso",
  "generoso",
  "grande",
  "incrível",
  "brilhante",
  "velho",
  "jovem",
  "maior",
] as const satisfies string[];

export const substantivosM = [
  "aço",
  "exército",
  "papel",
  "álcool",
  "escorpião",
  "pastor",
  "algodão",
  "espelho",
  "patriarca",
  "amanhecer",
  "filósofo",
  "pente",
  "amor",
  "garoto",
  "peixe",
  "apartamento",
  "pássaro",
  "verão",
  "arco-íris",
  "fracasso",
  "planeta",
  "armário",
  "geólogo",
  "púlpito",
  "assento",
  "boné",
  "rim",
  "azeite",
  "edifício",
  "panteão",
  "banco",
  "pardal",
  "roupeiro",
  "barro",
  "fígado",
  "saber",
  "bloco",
  "muro",
  "piano",
  "caixão",
  "homem",
  "saleiro",
  "caleidoscópio",
  "tijolo",
  "sapo",
  "calibrador",
  "louro",
  "satélite",
  "camarão",
  "lavabo",
  "sentido",
  "camelo",
  "controle",
  "senhor",
  "campeão",
  "livro",
  "solo",
  "campo",
  "macho",
  "cigarro",
  "câncer",
  "manuscrito",
  "tanque",
  "candelabro",
  "cacho",
  "teto",
  "capataz",
  "fogareiro",
  "teclado",
  "carro",
  "melão",
  "telhado",
  "castelo",
  "mercado",
  "telefone",
  "cavaleiro",
  "fio",
  "salário",
  "cemitério",
  "microscópio",
  "terreno",
  "cimento",
  "monte",
  "território",
  "computador",
  "joão-de-barro",
  "vaso",
  "dinheiro",
  "pau",
  "vidro",
  "dólar",
  "blusão",
  "volume",
  "gaúcho",
  "país",
  "ventilador",
  "gramado",
  "menino",
  "barão",
  "óculos",
  "fósforo",
  "chão",
  "porco",
  "urso",
  "copo",
  "sebo",
  "metal",
  "telescópio",
  "xadrez",
  "endoscópio",
  "pacote",
  "tigre",
  "leão",
  "carro",
  "avião",
  "computador",
  "robô",
  "planeta",
  "castelo",
  "cavalo",
  "pássaro",
  "inventor",
  "museu",
  "café",
  "sonho",
  "mar",
  "rio",
] as const satisfies string[];

// Listas de palavras para gênero feminino
export const adjetivosF = [
  "rápida",
  "forte",
  "brilhante",
  "boa",
  "feliz",
  "amável",
  "sábia",
  "valente",
  "viva",
  "nova",
  "audaz",
  "esperta",
  "ágil",
  "decidida",
  "destemida",
  "vigorosa",
  "agradável",
  "dura",
  "alegre",
  "enorme",
  "pequena",
  "antiga",
  "famosa",
  "generosa",
  "simpática",
  "grande",
  "honesta",
  "sincera",
  "incrível",
  "brilhante",
  "jovem",
  "maior",
] as const satisfies string[];

export const substantivosF = [
  "agenda",
  "doçura",
  "navalha",
  "ambulância",
  "escritora",
  "menina",
  "amiga",
  "espécie",
  "paixão",
  "antena",
  "estátua",
  "pérola",
  "antropóloga",
  "estrela",
  "pesca",
  "aranha",
  "filosofia",
  "pedra",
  "arquitetura",
  "flauta",
  "pintura",
  "azaleia",
  "flor",
  "pinça",
  "bacia",
  "mitologia",
  "janela",
  "biblioteca",
  "floricultura",
  "pipa",
  "bicicleta",
  "geometria",
  "placa",
  "bolsa",
  "borracha",
  "poesia",
  "borda",
  "borboleta",
  "torta",
  "buzina",
  "guloseima",
  "placenta",
  "calculadora",
  "lanterna",
  "toalha",
  "cama",
  "mulher",
  "sapataria",
  "camiseta",
  "almofada",
  "polícia",
  "capela",
  "graxa",
  "régua",
  "cara",
  "guitarra",
  "reunião",
  "carteira",
  "formiga",
  "revista",
  "casa",
  "igreja",
  "cadeira",
  "colcha",
  "lã",
  "sopa",
  "colheita",
  "professora",
  "tubulação",
  "colher",
  "motocicleta",
  "cobra",
  "colmeia",
  "caneta",
  "batina",
  "comida",
  "lata",
  "tina",
  "companheira",
  "grama",
  "tinta",
  "corda",
  "mola",
  "vida",
  "coroa",
  "lupa",
  "empada",
  "crise",
  "geleia",
  "urna",
  "dama",
  "boneca",
  "sandália",
  "doutora",
  "música",
  "canjica",
  "gravata",
  "chave",
  "tormenta",
  "habilidade",
  "mesa",
  "porca",
  "janta",
  "lâmpada",
  "sombra",
  "metralhadora",
  "canela",
  "oportunidade",
  "tampa",
  "amora",
  "verdura",
  "leoa",
  "pantera",
  "casa",
  "máquina",
  "flor",
  "estrela",
  "máquina",
  "invenção",
  "cidade",
  "lua",
  "musa",
  "rainha",
  "história",
  "canção",
  "arte",
  "melodia",
  "ideia",
  "nuvem",
  "terra",
  "porta",
  "rua",
  "avenida",
  "montanha",
  "cachoeira",
  "lagoa",
  "floresta",
  "riviera",
  "praia",
  "onda",
  "ilha",
  "brisa",
  "chuva",
  "tempestade",
  "neve",
  "geada",
  "fogueira",
  "chama",
  "centelha",
  "faísca",
  "escuridão",
  "luz",
  "névoa",
  "poeira",
  "lama",
  "areia",
  "rocha",
  "abelha",
  "joaninha",
  "mosca",
  "vespa",
  "lagarta",
  "minhoca",
  "lesma",
  "lagartixa",
  "salamandra",
  "tartaruga",
  "arara",
  "coruja",
  "águia",
  "gaivota",
  "pata",
  "galinha",
  "pomba",
  "baleia",
  "orca",
  "tubarão",
  "arraia",
  "sardinha",
  "enguia",
  "lula",
  "esponja",
  "ostra",
  "concha",
  "alga",
  "lagosta",
  "bactéria",
  "célula",
  "parede",
  "organela",
  "bolha",
  "temperatura",
  "sensação",
  "criança",
  "moça",
  "senhora",
  "avó",
  "mãe",
  "filha",
  "irmã",
  "prima",
  "tia",
  "sobrinha",
  "neta",
  "cônjuge",
  "esposa",
  "namorada",
  "colega",
  "vizinha",
  "estranha",
  "conhecida",
  "desconhecida",
  "pessoa",
  "criatura",
  "alma",
  "mente",
  "editora",
  "livraria",
  "papelaria",
  "hora",
  "semana",
  "década",
  "eternidade",
  "época",
  "era",
  "fase",
  "estação",
  "primavera",
  "madrugada",
  "manhã",
  "tarde",
  "noite",
  "alvorada",
  "aurora",
  "penumbra",
  "continuação",
  "pausa",
  "escola",
  "faculdade",
  "universidade",
  "família",
  "moradia",
  "residência",
  "mansão",
  "chácara",
  "fazenda",
  "roça",
  "aldeia",
  "galáxia",
  "constelação",
  "nebulosa",
  "atmosfera",
  "biosfera",
  "hidrosfera",
  "litosfera",
  "geografia",
  "geologia",
  "biologia",
  "química",
  "física",
  "matemática",
  "sociologia",
  "antropologia",
  "psicologia",
  "economia",
  "política",
  "medicina",
  "engenharia",
  "escultura",
  "dança",
  "fotografia",
  "crônica",
  "novela",
  "resenha",
  "crítica",
  "biografia",
  "autobiografia",
  "carta",
  "mensagem",
  "notificação",
  "ligação",
  "conversa",
  "voz",
  "harmonia",
  "cirurgia",
  "terapia",
  "cura",
  "vacina",
  "epidemia",
  "pandemia",
  "parasita",
  "testemunha",
  "vítima",
  "inocente",
] as const satisfies string[];

// Verbos e advérbios (os verbos não sofrem variação de gênero)
export const verbos = [
  "correr",
  "voar",
  "brilhar",
  "desbravar",
  "conquistar",
  "explorar",
  "descobrir",
  "transformar",
  "encantar",
  "inspirar",
  "amar",
  "estudar",
  "chegar",
  "pensar",
  "viver",
  "voltar",
  "pegar",
  "escrever",
  "conhecer",
  "aprender",
  "esquecer",
  "vender",
  "proteger",
  "nascer",
  "morrer",
  "lutar",
  "brincar",
  "cantar",
  "criar",
  "sonhar",
  "mudar",
  "vencer",
  "crescer",
  "saltar",
  "navegar",
  "gritar",
  "partir",
  "subir",
  "descer",
] as const satisfies string[];

export const adverbios = [
  "rapidamente",
  "suavemente",
  "elegantemente",
  "destemidamente",
  "vigorosamente",
  "alegremente",
  "tranquilamente",
  "discretamente",
  "honestamente",
  "simplesmente",
  "calmamente",
  "facilmente",
  "diariamente",
  "raramente",
  "violentamente",
  "apressadamente",
  "cuidadosamente",
  "delicadamente",
  "pacientemente",
  "atenciosamente",
  "silenciosamente",
  "felizmente",
  "fortemente",
  "lentamente",
  "tristemente",
] as const satisfies string[];

import { createHash, getHashes } from "crypto";

// Função que retorna um elemento aleatório de um array
function random<T extends {}>(
  arr: [T, ...T[]],
  offset: number = 0,
): T & { index: number } {
  const length = arr.length;
  const index = Math.floor(Math.random() * length);
  const choice = arr[(index + offset) % length];

  return Object.assign(choice, {
    index,
  }) as T & { index: number };
}

/**
 * Converte um verbo regular do infinitivo para a 3ª pessoa do singular do presente do indicativo.
 *
 * Ex.: "correr" → "corre", "voar" → "voa", "abrir" → "abre".
 */
function conjugate(verb: string): string {
  if (verb.endsWith("ar")) return `${verb.slice(0, -2)}a`;
  if (verb.endsWith("er") || verb.endsWith("ir"))
    return `${verb.slice(0, -2)}e`;

  return verb;
}

/**
 * Interface das opções para customizar o identificador.
 */
export interface Options {
  /**
   * Separador para juntar as partes da frase (padrão: "-").
   */
  separator?: string;
  /**
   * Quantidade de adjetivos (padrão: 2).
   */
  adjetivoCount?: 0 | 1 | 2;
  /**
   * Se deve incluir um advérbio no final (padrão: true).
   */
  addAdverb?: boolean;
  /**
   * Se a frase deve iniciar com letra maiúscula (padrão: false).
   */
  capitalize?: boolean;
  /**
   * Define o artigo a ser usado:
   * - "masculino": sempre usará "O"
   * - "feminino": sempre usará "A"
   * - "aleatorio" (padrão): escolhe aleatoriamente entre "O" e "A"
   */
  article?: "masculino" | "feminino" | "aleatorio";
}

/**
 * Retorna um identificador legível em português como frase completa.
 *
 * O padrão da frase é:
 * "[Artigo] + [adjetivo(s)] + [substantivo] + [verbo conjugado] (+ [advérbio])"
 *
 * A junção dos elementos utiliza o separador definido na opção.
 *
 * @param {Options} [options = {}]
 * @returns {string}
 */
export function identificadorHumano(options: Options = {}): string {
  const {
    separator = "-",
    adjetivoCount = 2,
    addAdverb = true,
    capitalize = false,
    article = "aleatorio",
  } = options;

  // Define o artigo e escolhe as listas de adjetivos e substantivos de acordo com o gênero.
  const hash = createHash("sha1", { outputLength: 32 });

  console.log(getHashes());
  let art: string;
  let adjsList: [string, ...string[]];
  let subsList: [string, ...string[]];

  if (article === "masculino") {
    art = "o";
    adjsList = adjetivosM;
    subsList = substantivosM;
  } else if (article === "feminino") {
    art = "a";
    adjsList = adjetivosF;
    subsList = substantivosF;
  } else {
    // aleatorio
    if (Math.random() < 0.5) {
      art = "o";
      adjsList = adjetivosM;
      subsList = substantivosM;
    } else {
      art = "a";
      adjsList = adjetivosF;
      subsList = substantivosF;
    }
  }

  // Seleciona os adjetivos
  const adjs: string[] = [];

  let offset = 0;

  for (let i = 0; i < adjetivoCount; i++) {
    const choice = random(adjsList, offset);

    adjs.push(choice);
    hash.update(choice.toString());
    offset = choice.index;
    if (i < adjetivoCount - 1) adjs.push("e");
  }
  const substantivo = random(subsList);
  const verboInf = random(verbos);
  const verboConj = conjugate(verboInf);

  hash.update(substantivo.toString());
  hash.update(verboInf.toString());
  hash.update(verboConj.toString());

  // Monta a frase usando o separador customizado
  const partes = [art, adjs.join(separator), substantivo, verboConj];

  if (addAdverb) {
    partes.push(random(adverbios));
  }

  const algos = [];
  for (const algo of getHashes()) {
    try {
      const hash = createHash(algo, { outputLength: 4 });
      for (const dig of partes) hash.update(dig.toString());
      const dig = hash.digest("binary").length;
      algos.push(dig);
      console.log(algo, dig, dig * 8);
    } catch {}
  }
  console.log(algos, Math.min(...algos));
  let frase = partes.join(separator);

  if (capitalize) {
    frase = frase.charAt(0).toUpperCase() + frase.slice(1);
  }

  const hash_ = hash.digest("binary");
  // return [frase, parseInt(hash_, 16), hash_, hash_.length];
  return frase;
}

/**
 * Retorna o tamanho do pool de identificadores baseado nas opções.
 *
 * Para "aleatorio", o pool é a soma dos pools masculino e feminino.
 *
 * @param {Options} [options = {}]
 * @returns {number}
 */
export function poolSize(options: Options = {}): number {
  const {
    adjetivoCount = 1,
    addAdverb = false,
    article = "aleatorio",
  } = options;

  const poolForGender = (adjsLength: number, subsLength: number) =>
    adjsLength ** adjetivoCount *
    subsLength *
    verbos.length *
    (addAdverb ? adverbios.length : 1);

  if (article === "masculino") {
    return poolForGender(adjetivosM.length, substantivosM.length);
  }
  if (article === "feminino") {
    return poolForGender(adjetivosF.length, substantivosF.length);
  }

  // aleatorio: soma dos dois pools
  return (
    poolForGender(adjetivosM.length, substantivosM.length) +
    poolForGender(adjetivosF.length, substantivosF.length)
  );
}

/**
 * Calcula o comprimento máximo possível para um identificador baseado nas opções.
 *
 * Considera o separador customizável e seleciona o maior comprimento entre masculino e feminino.
 *
 * @param {Options} [options = {}]
 * @returns {number}
 */
export function maxLength(options: Options = {}): number {
  const {
    adjetivoCount = 1,
    addAdverb = false,
    article = "aleatorio",
  } = options;

  // Função auxiliar para calcular o comprimento total de uma combinação
  const totalLength = (
    maxAdjs: number,
    maxSub: number,
    maxVerb: number,
    maxAdv = 0,
  ) =>
    // Comprimento total = soma dos comprimentos + separadores entre cada parte
    maxAdjs * adjetivoCount + // soma dos adjetivos
    adjetivoCount -
    1 + // separadores entre os adjetivos (se houver mais de um)
    maxSub +
    1 +
    maxVerb +
    (addAdverb ? 1 + maxAdv : 0) +
    2; // +2 para o artigo (O/A) e seu espaço

  // Calcula para masculino
  const maxM = totalLength(
    Math.max(...adjetivosM.map((a) => a.length)),
    Math.max(...substantivosM.map((s) => s.length)),
    Math.max(...verbos.map((v) => conjugate(v).length)),
    Math.max(...adverbios.map((a) => a.length)),
  );
  // Calcula para feminino
  const maxF = totalLength(
    Math.max(...adjetivosF.map((a) => a.length)),
    Math.max(...substantivosF.map((s) => s.length)),
    Math.max(...verbos.map((v) => conjugate(v).length)),
    Math.max(...adverbios.map((a) => a.length)),
  );

  if (article === "masculino") return maxM;
  if (article === "feminino") return maxF;

  return Math.max(maxM, maxF);
}

/**
 * Calcula o comprimento mínimo possível para um identificador baseado nas opções.
 *
 * Considera o separador customizável e seleciona o menor comprimento entre masculino e feminino.
 *
 * @param {Options} [options = {}]
 * @returns {number}
 */
export function minLength(options: Options = {}): number {
  const {
    adjetivoCount = 1,
    addAdverb = false,
    article = "aleatorio",
  } = options;

  const totalLength = (
    minAdjs: number,
    minSub: number,
    minVerb: number,
    minAdv = 0,
  ) =>
    minAdjs * adjetivoCount +
    adjetivoCount -
    1 +
    minSub +
    1 +
    minVerb +
    (addAdverb ? 1 + minAdv : 0) +
    2;

  const minM = totalLength(
    Math.min(...adjetivosM.map((a) => a.length)),
    Math.min(...substantivosM.map((s) => s.length)),
    Math.min(...verbos.map((v) => conjugate(v).length)),
    Math.min(...adverbios.map((a) => a.length)),
  );
  const minF = totalLength(
    Math.min(...adjetivosF.map((a) => a.length)),
    Math.min(...substantivosF.map((s) => s.length)),
    Math.min(...verbos.map((v) => conjugate(v).length)),
    Math.min(...adverbios.map((a) => a.length)),
  );

  if (article === "masculino") return minM;
  if (article === "feminino") return minF;

  return Math.min(minM, minF);
}

export default identificadorHumano;
